(function() {
  /*
  Bettertabs jQuery plugin v0.1

  jQuery(selector).bettertabs(); adds javascript to change content when click on tabs.

  Markup needed, the same that is generated by the rails bettertabs helper, added by the bettertabs plugin
     https://github.com/agoragames/bettertabs

  Events: Each time a tab is selected, some events are fired, so you can easily activate
      behavior from another jquery script (using .bind); The available events are:
            'bettertabs-before-deactivate': fired on the tab or content that is active and will be deactivated
            'bettertabs-before-activate': fired on the tab or content that will be activated
            'bettertabs-after-deactivate': fired on the tab or content that was deactivated
            'bettertabs-after-activate': fired on the tab or content that was activated

  */  var $, after_activate_event, after_deactivate_event, before_activate_event, before_deactivate_event, content_id_from, show_content_id_attr, tab_type_attr, tab_type_of;
  $ = jQuery;
  tab_type_attr = 'data-tab-type';
  show_content_id_attr = 'data-show-content-id';
  tab_type_of = function($tab_link) {
    return $tab_link.attr(tab_type_attr);
  };
  content_id_from = function($tab_link) {
    return $tab_link.attr(show_content_id_attr);
  };
  before_deactivate_event = 'bettertabs-before-deactivate';
  before_activate_event = 'bettertabs-before-activate';
  after_deactivate_event = 'bettertabs-after-deactivate';
  after_activate_event = 'bettertabs-after-activate';
  $.fn.bettertabs = function() {
    return this.each(function() {
      var mytabs, tabs, tabs_and_contents, tabs_contents, tabs_links;
      mytabs = $(this);
      tabs = mytabs.find('ul.tabs > li');
      tabs_links = mytabs.find('ul.tabs > li > a');
      tabs_contents = mytabs.children('.content');
      tabs_and_contents = tabs.add(tabs_contents);
      return tabs_links.click(function(event) {
        var previous_active_tab, previous_active_tab_content, this_link, this_tab, this_tab_and_content, this_tab_content;
        this_link = $(this);
        if (tab_type_of(this_link) !== 'link') {
          event.preventDefault();
          this_tab = this_link.parent();
          if (!this_tab.is('.active')) {
            this_tab_content = tabs_contents.filter("#" + (content_id_from(this_link)));
            this_tab_and_content = this_tab.add(this_tab_content);
            previous_active_tab = tabs.filter('.active');
            previous_active_tab_content = tabs_contents.filter('.active');
            previous_active_tab_content.trigger(before_deactivate_event);
            this_tab_content.trigger(before_activate_event);
            tabs_and_contents.removeClass('active').addClass('hidden');
            this_tab_and_content.removeClass('hidden').addClass('active');
            previous_active_tab_content.trigger(after_deactivate_event);
            return this_tab_content.trigger(after_activate_event);
          }
        }
      });
    });
  };
}).call(this);
